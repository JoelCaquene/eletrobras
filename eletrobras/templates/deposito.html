{% extends "base.html" %}
{% load static %}

{% block title %}Página de Depósito{% endblock %}

{% block content %}
<style>
    /* Estilos Básicos para a página de Depósito */
    :root {
        --primary-color: #007bff; /* Azul primário (adapte à sua cor) */
        --success-color: #28a745;
        --warning-color: #ffc107;
        --border-color: #dee2e6;
        --bg-light: #f8f9fa;
    }

    .card-deposito {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        padding: 25px;
        margin-bottom: 30px;
    }

    .bank-details-card {
        border-left: 5px solid var(--primary-color);
        padding: 15px;
        background-color: var(--bg-light);
        margin-bottom: 20px;
        border-radius: 5px;
    }

    .bank-details-card h5 {
        color: var(--primary-color);
        font-weight: bold;
        margin-bottom: 10px;
    }

    .info-box {
        background-color: #fff3cd; /* Fundo amarelo claro */
        border: 1px solid #ffeeba;
        color: #856404;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
        font-size: 0.9em;
    }
    
    .copy-btn {
        background-color: var(--success-color);
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        margin-left: 10px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .copy-btn:hover {
        background-color: #218838;
    }

    /* Estilização específica para os campos do formulário */
    .form-group label {
        font-weight: 500;
        margin-bottom: 5px;
    }
</style>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h2 class="text-center mb-4 text-primary">💰 Área de Depósito e Transparência</h2>
            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="card-deposito">
                <h3 class="text-center mb-4">1. Coordenadas Bancárias da ELETROBRAS</h3>
                <p class="text-muted text-center">Use as coordenadas abaixo para fazer a transferência. **Guarde o comprovativo!**</p>
                
                {% for detalhes in detalhes_bancarios %}
                <div class="bank-details-card">
                    <h5>Banco Destino: {{ detalhes.nome_banco }}</h5>
                    <p>
                        <strong>Titular da Conta:</strong> 
                        <span id="nome-titular-{{ detalhes.id }}">{{ detalhes.nome_titular_conta }}</span>
                        <button class="copy-btn" data-target="nome-titular-{{ detalhes.id }}">Copiar</button>
                    </p>
                    <p>
                        <strong>IBAN:</strong> 
                        <span id="iban-{{ detalhes.id }}">{{ detalhes.iban }}</span>
                        <button class="copy-btn" data-target="iban-{{ detalhes.id }}">Copiar</button>
                    </p>
                </div>
                {% empty %}
                <div class="alert alert-warning">
                    Nenhuma coordenada bancária da plataforma encontrada. Contacte o suporte.
                </div>
                {% endfor %}
            </div>

            <div class="card-deposito">
                <h3 class="text-center mb-4">2. Regras de Saque da Plataforma</h3>
                
                {% if config %}
                <div class="row text-center">
                    <div class="col-md-4 mb-3">
                        <div class="p-3 border rounded">
                            <h5 class="text-primary">Saque Mínimo</h5>
                            <p class="h4 text-success">{{ config.saque_minimo }} KZ</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 border rounded">
                            <h5 class="text-primary">Taxa de Saque</h5>
                            <p class="h4 text-warning">{{ config.taxa_saque|floatformat:"-2" }}%</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 border rounded">
                            <h5 class="text-primary">Horário de Saque</h5>
                            <p class="h5 text-info">{{ config.horario_saque_inicio|time:"H:i" }} - {{ config.horario_saque_fim|time:"H:i" }}</p>
                            <p class="text-muted small">(Horário de Luanda)</p>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-info">
                    As regras de saque não foram definidas pelo administrador.
                </div>
                {% endif %}
                
                <div class="info-box">
                    **AVISO IMPORTANTE:** Os depósitos são revistos e **aprovados manualmente** pelo administrador. Após a submissão, o seu saldo será atualizado em algumas horas.
                </div>
            </div>

            <div class="card-deposito">
                <h3 class="text-center mb-4">3. Submeter Comprovativo de Depósito</h3>
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}

                    <div class="form-group mb-3">
                        {{ form.valor.label_tag }}
                        {{ form.valor }}
                        {% if form.valor.errors %}<div class="text-danger small">{{ form.valor.errors }}</div>{% endif %}
                    </div>
                    
                    <div class="form-group mb-3">
                        {{ form.nome_cliente_banco.label_tag }}
                        {{ form.nome_cliente_banco }}
                        {% if form.nome_cliente_banco.errors %}<div class="text-danger small">{{ form.nome_cliente_banco.errors }}</div>{% endif %}
                    </div>
                    
                    <div class="form-group mb-4">
                        {{ form.comprovativo_imagem.label_tag }}
                        {{ form.comprovativo_imagem }}
                        {% if form.comprovativo_imagem.errors %}<div class="text-danger small">{{ form.comprovativo_imagem.errors }}</div>{% endif %}
                        <small class="form-text text-muted">Apenas arquivos de imagem (JPEG, PNG).</small>
                    </div>

                    {{ form.banco_destino_nome }} <button type="submit" class="btn btn-primary btn-block btn-lg w-100">Submeter Depósito</button>
                </form>
            </div>

        </div>
    </div>
</div>

<script>
    // Função JavaScript para copiar texto
    document.addEventListener('DOMContentLoaded', function() {
        const copyButtons = document.querySelectorAll('.copy-btn');
        copyButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);
                
                // Cria um elemento temporário para copiar o texto
                const tempInput = document.createElement('input');
                tempInput.value = targetElement.textContent.trim();
                document.body.appendChild(tempInput);
                
                // Seleciona e copia
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                // Feedback visual
                const originalText = this.textContent;
                this.textContent = 'Copiado!';
                this.style.backgroundColor = 'var(--primary-color)';
                
                setTimeout(() => {
                    this.textContent = originalText;
                    this.style.backgroundColor = 'var(--success-color)';
                }, 1500);
            });
        });
    });
</script>

{% endblock content %}
